<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="FinanceFlow - Controle Financeiro Completo">
  <title>FinanceFlow - Controle Financeiro</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* SEU CSS ORIGINAL - mantido com pequenas adi√ß√µes para a tabela */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary: #0077b6; --primary-dark: #005a8d; --primary-light: #00a8e8;
      --success: #28a745; --warning: #ffc107; --danger: #dc3545; --info: #17a2b8;
      --neutral-50: #f8f9fa; --neutral-100: #f1f3f5; --neutral-200: #e9ecef;
      --neutral-400: #6c757d; --neutral-800: #212529; --white: #ffffff;
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
      --shadow-md: 0 4px 16px rgba(0, 119, 182, 0.08);
      --shadow-lg: 0 8px 24px rgba(0, 119, 182, 0.12);
      --radius-sm: 8px; --radius-md: 12px; --radius-lg: 16px; --radius-xl: 20px;
      --transition: all 0.3s ease;
    }
    body {
      background: linear-gradient(135deg, #f4f7fb 0%, #e8f0f7 100%);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      display: flex; justify-content: center; padding: 24px 16px;
      min-height: 100vh; color: var(--neutral-800); line-height: 1.6;
    }
    .container {
      width: 100%; max-width: 1400px; background: var(--white);
      border-radius: 24px; box-shadow: var(--shadow-md); padding: 40px;
    }
    h1 {
      text-align: center; margin-bottom: 8px; color: var(--primary);
      font-size: 2.5rem; font-weight: 700; letter-spacing: -0.5px;
    }
    .subtitle {
      text-align: center; color: var(--neutral-400); font-size: 0.95rem;
      margin-bottom: 32px; font-weight: 400;
    }
    .form {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px; margin-bottom: 24px; background: var(--neutral-50);
      padding: 24px; border-radius: var(--radius-lg); box-shadow: var(--shadow-sm);
    }
    .form input, .form select {
      padding: 12px 16px; border: 2px solid var(--neutral-200);
      border-radius: var(--radius-md); font-size: 0.95rem;
      transition: var(--transition); background: var(--white); font-family: inherit;
    }
    .form input:focus, .form select:focus {
      outline: none; border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0, 119, 182, 0.1);
    }
    .form button {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: var(--white); border: none; border-radius: var(--radius-md);
      padding: 12px 20px; cursor: pointer; font-weight: 600; font-size: 0.95rem;
      transition: var(--transition); box-shadow: 0 4px 12px rgba(0, 119, 182, 0.2);
      font-family: inherit;
    }
    .form button:hover {
      transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0, 119, 182, 0.3);
    }
    .reset-btn {
      background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%) !important;
      box-shadow: 0 4px 12px rgba(220, 53, 69, 0.2) !important;
    }
    .tabs {
      display: flex; gap: 8px; margin-bottom: 24px;
      border-bottom: 2px solid var(--neutral-100); overflow-x: auto;
    }
    .tab-button {
      padding: 12px 24px; background: transparent; border: none;
      border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600;
      font-size: 0.95rem; color: var(--neutral-400); transition: var(--transition);
      white-space: nowrap;
    }
    .tab-button:hover {
      color: var(--primary); background: var(--neutral-50);
      border-radius: var(--radius-md) var(--radius-md) 0 0;
    }
    .tab-button.active { color: var(--primary); border-bottom-color: var(--primary); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .stats-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px; margin-bottom: 24px;
    }
    .stat-card {
      background: var(--white); padding: 20px; border-radius: var(--radius-lg);
      text-align: center; border: 2px solid var(--neutral-100);
      transition: var(--transition); box-shadow: var(--shadow-sm);
    }
    .stat-card:hover {
      border-color: var(--primary); transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    .stat-card .stat-label {
      font-size: 0.75rem; color: var(--neutral-400); text-transform: uppercase;
      font-weight: 600; margin-bottom: 8px; letter-spacing: 0.5px;
    }
    .stat-card .stat-value { font-size: 1.5rem; font-weight: 700; color: var(--neutral-800); }
    .stat-card.positive .stat-value { color: var(--success); }
    .stat-card.negative .stat-value { color: var(--danger); }
    .stat-card.neutral .stat-value { color: var(--primary); }
    .stat-card.warning .stat-value { color: var(--warning); }
    .progress-bar {
      width: 100%; height: 6px; background: var(--neutral-200);
      border-radius: 10px; overflow: hidden; margin-top: 8px;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
      transition: width 0.5s ease; border-radius: 10px;
    }
    .dashboard {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 24px; margin-bottom: 24px;
    }
    .card {
      background: var(--white); padding: 28px; border-radius: var(--radius-xl);
      box-shadow: var(--shadow-sm); border: 1px solid var(--neutral-100);
      transition: var(--transition);
    }
    .card:hover { box-shadow: var(--shadow-lg); transform: translateY(-2px); }
    .card h2 {
      font-size: 1.25rem; color: var(--neutral-800); margin-bottom: 20px;
      font-weight: 600; display: flex; align-items: center; gap: 8px;
    }
    /* Removendo estilos de UL/LI antigos para a nova tabela */
    ul { list-style: none; /*max-height: 400px;*/ overflow-y: auto; }
    ul::-webkit-scrollbar { width: 6px; }
    ul::-webkit-scrollbar-track { background: var(--neutral-100); border-radius: 10px; }
    ul::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }
    li { /* Estes estilos ser√£o substitu√≠dos pela nova estrutura de tabela */
      /* padding: 12px 8px; border-bottom: 1px solid var(--neutral-100);
      display: flex; justify-content: space-between; align-items: center;
      font-size: 0.95rem; color: var(--neutral-800);
      transition: background 0.2s ease; border-radius: var(--radius-sm); */
    }
    li:hover { background: var(--neutral-50); }
    .item-info { flex: 1; display: flex; flex-direction: column; gap: 4px; }
    .item-title { font-weight: 600; }
    .item-detail { font-size: 0.85rem; color: var(--neutral-400); }
    .item-actions { display: flex; gap: 8px; align-items: center; }
    .badge {
      padding: 4px 10px; border-radius: var(--radius-sm); font-size: 0.75rem;
      font-weight: 600; text-transform: uppercase;
    }
    .badge.paid { background: #d4edda; color: #155724; }
    .badge.pending { background: #fff3cd; color: #856404; }
    .badge.received { background: #d1ecf1; color: #0c5460; }
    .badge.expected { background: #e2e3e5; color: #383d41; }
    .btn {
      border: none; border-radius: var(--radius-sm); padding: 6px 12px;
      cursor: pointer; font-size: 0.75rem; font-weight: 600;
      transition: var(--transition); font-family: inherit;
    }
    .btn-success { background: var(--success); color: var(--white); }
    .btn-danger { background: var(--danger); color: var(--white); }
    .btn-info { background: var(--info); color: var(--white); }
    .btn:hover { opacity: 0.9; transform: scale(1.05); }
    .total {
      font-weight: 600; margin-top: 16px; padding-top: 16px;
      border-top: 2px solid var(--primary); color: var(--primary);
      font-size: 1.25rem;
    }
    .empty-state {
      text-align: center; padding: 40px 20px; color: var(--neutral-400);
    }
    .empty-state-icon { font-size: 3rem; margin-bottom: 12px; opacity: 0.3; }
    .empty-state-text { font-size: 1rem; font-weight: 500; }
    .fade-in { animation: fadeIn 0.4s ease-in; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @media (max-width: 768px) {
      .container { padding: 24px 16px; }
      h1 { font-size: 2rem; }
      .form { grid-template-columns: 1fr; }
      .stats-grid { grid-template-columns: 1fr; }
      .dashboard { grid-template-columns: 1fr; }
      .tabs { flex-wrap: nowrap; }
    }

    /* --- MELHORIAS ADICIONADAS --- */

    /* 1. Labels "Screen-reader only" para Acessibilidade */
    .sr-only {
      position: absolute; width: 1px; height: 1px;
      padding: 0; margin: -1px; overflow: hidden;
      clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0;
    }

    /* 2. Notifica√ß√£o "Toast" (substitui o alert()) */
    #toast {
      position: fixed;
      bottom: -100px;
      left: 50%;
      transform: translateX(-50%);
      padding: 16px 24px;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      font-weight: 600;
      color: var(--white);
      transition: bottom 0.5s ease-in-out;
      z-index: 1000;
    }
    #toast.show { bottom: 30px; }
    #toast.success { background: var(--success); }
    #toast.error { background: var(--danger); }
    #toast.info { background: var(--primary); }

    /* 3. Estilos da Tabela (substitui a lista de transa√ß√µes) */
    .table-responsive {
        width: 100%;
        overflow-x: auto; /* Permite rolagem horizontal em telas pequenas */
        -webkit-overflow-scrolling: touch; /* Melhor rolagem em iOS */
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-sm);
        margin-top: 20px;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse; /* Remove espa√ßamento entre as c√©lulas */
        background-color: var(--white);
        min-width: 600px; /* Garante que a tabela n√£o fique muito pequena */
    }

    .data-table thead {
        background-color: var(--neutral-100);
        border-bottom: 2px solid var(--neutral-200);
    }

    .data-table th, .data-table td {
        padding: 14px 20px;
        text-align: left;
        border-bottom: 1px solid var(--neutral-100);
    }

    .data-table th {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--neutral-400);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .data-table td {
        font-size: 0.9rem;
        color: var(--neutral-800);
    }

    .data-table tbody tr:hover {
        background-color: var(--neutral-50);
    }

    .data-table .type-icon {
        margin-right: 8px;
        font-size: 1.1rem;
    }

    .data-table .value-cell {
        font-weight: 600;
        text-align: right; /* Alinha valores monet√°rios √† direita */
    }

    .data-table .actions-cell {
        text-align: center;
        width: 100px; /* Largura fixa para os bot√µes de a√ß√£o */
    }
    
    .data-table .actions-cell .btn {
      padding: 5px 10px; /* Ajusta o padding dos bot√µes na tabela */
    }

    /* Cores espec√≠ficas para valores */
    .data-table .value-positive { color: var(--success); }
    .data-table .value-negative { color: var(--danger); }

    /* Responsividade da tabela */
    @media (max-width: 600px) {
        .data-table th, .data-table td {
            padding: 10px 15px; /* Reduz padding em telas menores */
        }
        .data-table th:nth-child(4),
        .data-table td:nth-child(4) {
            display: none; /* Esconde a coluna de categoria em telas muito pequenas */
        }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üí∞ FinanceFlow</h1>
    <div class="subtitle">Controle Financeiro Completo</div>

    <div class="tabs">
      <button class="tab-button active" data-aba="transacoes">üìä Transa√ß√µes</button>
      <button class="tab-button" data-aba="dividas">üí≥ D√≠vidas</button>
      <button class="tab-button" data-aba="lucros">üíé Lucros</button>
      <button class="tab-button" data-aba="salario">üíº Sal√°rio</button>
    </div>

    <div id="tab-transacoes" class="tab-content active">
      <div class="form">
        <label for="tipo" class="sr-only">Tipo</label>
        <select id="tipo">
          <option value="gasto">üí∏ Gasto</option>
          <option value="receita">üíµ Receita</option>
        </select>
        <label for="categoria" class="sr-only">Categoria</label>
        <select id="categoria">
          <option value="Abundar">Abundar</option> <option value="Doar">Doar</option>
          <option value="Investir">Investir</option> <option value="Educar">Educar</option>
          <option value="Desfrutar">Desfrutar</option> <option value="Conquistar">Conquistar</option>
          <option value="Sustentar">Sustentar</option> <option value="Bug">Bug</option>
        </select>
        <label for="descricao" class="sr-only">Descri√ß√£o</label>
        <input type="text" id="descricao" placeholder="Descri√ß√£o">
        <label for="valor" class="sr-only">Valor</label>
        <input type="number" id="valor" placeholder="Valor (R$)" step="0.01">
        <button id="btnAdicionarTransacao">‚ûï Adicionar</button>
        <button class="reset-btn" id="btnResetApp">üóëÔ∏è Resetar</button>
      </div>

      <div class="stats-grid">
        <div class="stat-card positive">
          <div class="stat-label">üíµ Total Receitas</div>
          <div class="stat-value" id="totalReceitas" aria-live="polite">R$ 0,00</div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressReceitas" style="width: 0%"></div>
          </div>
        </div>
        <div class="stat-card negative">
          <div class="stat-label">üí∏ Total Gastos</div>
          <div class="stat-value" id="totalGastos" aria-live="polite">R$ 0,00</div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressGastos" style="width: 0%; background: linear-gradient(90deg, #dc3545 0%, #ff6b7a 100%)"></div>
          </div>
        </div>
        <div class="stat-card neutral">
          <div class="stat-label">üí∞ Saldo Atual</div>
          <div class="stat-value" id="saldoAtual" aria-live="polite">R$ 0,00</div>
        </div>
      </div>

      <div class="dashboard">
        <div class="card">
          <h2>üìä Distribui√ß√£o por Categoria</h2>
          <canvas id="graficoTransacoes"></canvas>
        </div>
        <div class="card">
          <h2>üìù Hist√≥rico de Transa√ß√µes</h2>
          <div class="table-responsive">
            <table class="data-table" id="listaTransacoes">
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Descri√ß√£o</th>
                        <th>Categoria</th>
                        <th>Data</th>
                        <th style="text-align: right;">Valor</th>
                        <th style="text-align: center;">A√ß√µes</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div id="tab-dividas" class="tab-content">
      <div class="form">
        <input type="text" id="dividaNome" placeholder="Nome da d√≠vida">
        <input type="number" id="dividaValor" placeholder="Valor (R$)" step="0.01">
        <input type="date" id="dividaVencimento">
        <input type="text" id="dividaCredor" placeholder="Credor">
        <button onclick="adicionarDivida()">‚ûï Adicionar D√≠vida</button>
      </div>

      <div class="stats-grid">
        <div class="stat-card negative">
          <div class="stat-label">üí≥ D√≠vidas Pendentes</div>
          <div class="stat-value" id="totalDividasPendentes">R$ 0,00</div>
        </div>
        <div class="stat-card positive">
          <div class="stat-label">‚úÖ D√≠vidas Pagas</div>
          <div class="stat-value" id="totalDividasPagas">R$ 0,00</div>
        </div>
        <div class="stat-card warning">
          <div class="stat-label">‚è∞ Vencendo Hoje</div>
          <div class="stat-value" id="dividasVencendo">0</div>
        </div>
      </div>

      <div class="dashboard">
        <div class="card">
          <h2>üìà Status das D√≠vidas</h2>
          <canvas id="graficoDividas"></canvas>
        </div>
        <div class="card">
          <h2>üí≥ Lista de D√≠vidas</h2>
          <ul id="listaDividas"></ul>
        </div>
      </div>
    </div>

    <div id="tab-lucros" class="tab-content">
      <div class="form">
        <input type="text" id="lucroFonte" placeholder="Fonte do lucro">
        <input type="number" id="lucroValor" placeholder="Valor (R$)" step="0.01">
        <input type="date" id="lucroData">
        <select id="lucroStatus">
          <option value="esperado">Esperado</option>
          <option value="recebido">Recebido</option>
        </select>
        <button onclick="adicionarLucro()">‚ûï Adicionar Lucro</button>
      </div>

      <div class="stats-grid">
        <div class="stat-card positive">
          <div class="stat-label">üíé Lucros Recebidos</div>
          <div class="stat-value" id="totalLucrosRecebidos">R$ 0,00</div>
        </div>
        <div class="stat-card neutral">
          <div class="stat-label">‚è≥ Lucros Esperados</div>
          <div class="stat-value" id="totalLucrosEsperados">R$ 0,00</div>
        </div>
        <div class="stat-card warning">
          <div class="stat-label">üìä Taxa de Realiza√ß√£o</div>
          <div class="stat-value" id="taxaRealizacao">0%</div>
        </div>
      </div>

      <div class="dashboard">
        <div class="card">
          <h2>üí∞ Distribui√ß√£o de Lucros</h2>
          <canvas id="graficoLucros"></canvas>
        </div>
        <div class="card">
          <h2>üíé Lista de Lucros</h2>
          <ul id="listaLucros"></ul>
        </div>
      </div>
    </div>

    <div id="tab-salario" class="tab-content">
      <div class="form">
        <input type="number" id="salario" placeholder="Sal√°rio mensal (R$)" step="0.01">
        <button onclick="definirSalario()">üíº Definir Sal√°rio</button>
      </div>

      <div class="stats-grid">
        <div class="stat-card neutral">
          <div class="stat-label">üíº Sal√°rio Mensal</div>
          <div class="stat-value" id="salarioMensal">R$ 0,00</div>
        </div>
        <div class="stat-card negative">
          <div class="stat-label">üí∏ Total Comprometido</div>
          <div class="stat-value" id="totalComprometido">R$ 0,00</div>
        </div>
        <div class="stat-card positive">
          <div class="stat-label">üí∞ Dispon√≠vel</div>
          <div class="stat-value" id="salarioDisponivel">R$ 0,00</div>
        </div>
      </div>

      <div class="dashboard">
        <div class="card">
          <h2>üìä Uso do Sal√°rio</h2>
          <canvas id="graficoSalario"></canvas>
        </div>
        <div class="card">
          <h2>üìà Resumo Financeiro</h2>
          <div style="padding: 20px;">
            <div style="margin-bottom: 16px;">
              <strong>Receita Total:</strong> <span id="resumoReceita">R$ 0,00</span>
            </div>
            <div style="margin-bottom: 16px;">
              <strong>Gastos Totais:</strong> <span id="resumoGastos">R$ 0,00</span>
            </div>
            <div style="margin-bottom: 16px;">
              <strong>D√≠vidas Pendentes:</strong> <span id="resumoDividas">R$ 0,00</span>
            </div>
            <div style="margin-bottom: 16px;">
              <strong>Lucros Esperados:</strong> <span id="resumoLucros">R$ 0,00</span>
            </div>
            <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #0077b6; font-size: 1.2rem;">
              <strong>Saldo Final:</strong> <span id="saldoFinal" style="color: #0077b6;">R$ 0,00</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="toast"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      let dados = {
        gastos: [], receitas: [], dividas: [], lucros: [], salario: 0
      };

      const coresCategorias = {
        Abundar: "#264653", Doar: "#2a9d8f", Investir: "#e9c46a", Educar: "#f4a261",
        Desfrutar: "#e76f51", Conquistar: "#6a4c93", Sustentar: "#0077b6", Bug: "#90e0ef"
      };

      const baseConfigGrafico = {
        options: {
          responsive: true, maintainAspectRatio: true,
          plugins: {
            legend: { position: "bottom", labels: { padding: 12, font: { size: 11 }, usePointStyle: true } },
            tooltip: {
              backgroundColor: 'rgba(0,0,0,0.8)', padding: 12, cornerRadius: 8,
              callbacks: {
                label: function(ctx) {
                  let valor = ctx.raw;
                  if (ctx.dataset.label === 'Porcentagem') { // Para gr√°ficos de pizza/doughnut
                    let total = ctx.dataset.data.reduce((a,b) => a+b, 0);
                    let pct = total > 0 ? ((valor/total)*100).toFixed(1) : 0;
                    return `${ctx.label}: R$ ${valor.toFixed(2)} (${pct}%)`;
                  }
                  return `${ctx.label}: R$ ${valor.toFixed(2)}`; // Para barras
                }
              }
            }
          },
          animation: { duration: 800 }
        }
      };

      // Gr√°fico de Transa√ß√µes (AGORA √â BARRA HORIZONTAL)
      const graficoTransacoes = new Chart(document.getElementById("graficoTransacoes").getContext("2d"), {
        type: "bar", // MUDAN√áA: tipo de gr√°fico
        data: {
          labels: Object.keys(coresCategorias),
          datasets: [{
            label: 'Total Gasto por Categoria',
            data: Array(8).fill(0),
            backgroundColor: Object.values(coresCategorias),
            borderColor: '#fff',
            borderWidth: 1
          }]
        },
        options: {
          ...baseConfigGrafico.options,
          indexAxis: 'y', // Faz as barras serem horizontais
          scales: {
            x: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Valor (R$)'
              }
            },
            y: {
              title: {
                display: true,
                text: 'Categoria'
              }
            }
          }
        }
      });

      // Gr√°fico de D√≠vidas (mantido como doughnut)
      const graficoDividas = new Chart(document.getElementById("graficoDividas").getContext("2d"), {
        type: "doughnut",
        data: {
          labels: ["Pagas", "Pendentes"],
          datasets: [{ data: [0, 0], backgroundColor: ["#28a745", "#dc3545"], borderWidth: 2, borderColor: "#fff" }]
        },
        options: { ...baseConfigGrafico.options }
      });

      // Gr√°fico de Lucros (mantido como doughnut)
      const graficoLucros = new Chart(document.getElementById("graficoLucros").getContext("2d"), {
        type: "doughnut",
        data
